<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/Perfil_COC-removebg-preview.png" type="image/x-icon">
    <title>Clash City BR - Desempenho de Guerra</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <nav>
        <a href="https://clashcitybr.github.io">Home</a>
    </nav>

    <header>
        <h1 class="scroll-anim">Desempenho de Guerra</h1>
        <p class="scroll-anim" style="color: var(--primary); font-weight: 600;">Sele√ß√£o Oficial para a Liga de Cl√£s</p>
    </header>

    <section id="ranking" class="ranking-section">
        <div class="ranking-card scroll-anim">
            <h2 class="title">üìä RANKING MENSAL ACUMULADO</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Jogador</th>
                            <th>M√©dia ‚≠ê</th>
                            <th>M√©dia %</th>
                            <th>CV</th>
                            <th>Guerras</th>

                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="corpoRanking">
                        <tr>
                            <td colspan="7" style="text-align:center;">Carregando dados da Fam√≠lia...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p style="margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center;">
                * Dados atualizados automaticamente via Google Sheets ap√≥s cada guerra.
            </p>
        </div>
    </section>

    <footer>
        <p>¬© 2026 Clash City BR - Sistema de Gest√£o de Guerra</p>
    </footer>

    <script>
        // 1. LINK DA PLANILHA (CSV PUBLICADO)
        const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSiUmjut5jrsU0_71z_k-l_enGQ8owypWsyAHd3Xxp8KGkhG9GDI8awbPTvaNY7z6Clz0XpLs5IUGkI/pub?output=csv";

        async function carregarDados() {
            try {
                const resposta = await fetch(urlCSV);
                const csv = await resposta.text();
                const linhas = csv.split(/\r?\n/).slice(1);

                let jogadores = {};

                linhas.forEach(linha => {
                    const col = linha.split(',');
                    if (col.length < 7) return;

                    const nome = col[1].trim();
                    const cv = col[2].trim();
                    const e1 = parseInt(col[3]) || 0;
                    const p1 = parseInt(col[4]) || 0;
                    const e2 = parseInt(col[5]) || 0;
                    const p2 = parseInt(col[6]) || 0;

                    if (!jogadores[nome]) {
                        jogadores[nome] = { nome, cv, totalE: 0, totalP: 0, qtd: 0 };
                    }
                    jogadores[nome].cv = cv;
                    jogadores[nome].totalE += (e1 + e2);
                    jogadores[nome].totalP += (p1 + p2) / 2;
                    jogadores[nome].qtd += 1;
                });

                const ranking = Object.values(jogadores).map(p => ({
                    ...p,
                    mediaE: p.totalE / p.qtd,
                    mediaP: p.totalP / p.qtd
                })).sort((a, b) => {
                    // 1¬∫ Crit√©rio: M√©dia de Estrelas (Maior para menor)
                    if (b.mediaE !== a.mediaE) {
                        return b.mediaE - a.mediaE;
                    }
                    // 2¬∫ Crit√©rio: M√©dia de Porcentagem (Maior para menor)
                    if (b.mediaP !== a.mediaP) {
                        return b.mediaP - a.mediaP;
                    }
                    // 3¬∫ Crit√©rio: Quantidade de Guerras (Maior para menor)
                    if (b.qtd !== a.qtd) {
                        return b.qtd - a.qtd;
                    }
                    // 4¬∫ Crit√©rio: N√≠vel do CV (Maior para menor)
                    // Usamos parseInt para garantir que a compara√ß√£o seja num√©rica
                    return parseInt(b.cv) - parseInt(a.cv);
                });

                renderizar(ranking);
            } catch (e) {
                console.error(e);
                document.getElementById('corpoRanking').innerHTML = "<tr><td colspan='7'>Erro ao carregar dados.</td></tr>";
            }
        }

        function renderizar(dados) {
    const corpo = document.getElementById('corpoRanking');
    if (!corpo) return;

    let htmlFinal = "";
    let rankReal = 1; // O n√∫mero que ser√° exibido

    dados.forEach((p, i) => {
        // L√≥gica de Empate:
        // Se n√£o for o primeiro da lista, verifica se empatou com o anterior em TODOS os crit√©rios
        if (i > 0) {
            const anterior = dados[i - 1];
            const empatou = p.mediaE === anterior.mediaE && 
                            p.mediaP === anterior.mediaP && 
                            p.qtd === anterior.qtd && 
                            p.cv === anterior.cv;
            
            // Se N√ÉO empatou, o rank vira a posi√ß√£o real (i + 1)
            // Se empatou, ele mant√©m o rankReal anterior
            if (!empatou) {
                rankReal = i + 1;
            }
        }

        // Status baseado no rankReal (ou no √≠ndice i se preferir manter o corte fixo de 10/20)
        const status = rankReal <= 10 
            ? '<span class="titular-badge">ELITE</span>' 
            : rankReal <= 21 
                ? '<span class="reserva-badge">Na M√©dia</span>' 
                : '<span class="bagre-badge">BAGRE</span>';

        // Estilo das Medalhas
        const medalhas = ["ü•á", "ü•à", "ü•â"];
        const rankLabel = rankReal <= 3 ? medalhas[rankReal - 1] : rankReal + "¬∫";
        const rankClass = rankReal <= 3 ? 'top-3' : 'rank-number';

        htmlFinal += `
            <tr>
                <td class="${rankClass}">${rankLabel}</td>
                <td><strong>${p.nome}</strong></td>
                <td style="color: #c08d00; font-weight: bold;">‚≠ê ${p.mediaE.toFixed(2)}</td>
                <td>${p.mediaP.toFixed(1)}%</td>
                <td><span class="cv-tag">CV ${p.cv}</span></td>
                <td>${p.qtd}</td>
                <td>${status}</td>
            </tr>`;
    });

    corpo.innerHTML = htmlFinal;
}
        // Anima√ß√£o de Scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('show');
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.scroll-anim').forEach((el) => observer.observe(el));

        // Inicia o carregamento
        carregarDados();
    </script>
</body>

</html>