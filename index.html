<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/Perfil_COC-removebg-preview.png" type="image/x-icon">
    <title>Clash City BR - Desempenho de Guerra</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <nav>
        <a href="https://clashcitybr.github.io">Home</a>
    </nav>

    <header>
        <h1 class="scroll-anim">Desempenho de Guerra</h1>
        <p class="scroll-anim" style="color: var(--primary); font-weight: 600;">SeleÃ§Ã£o Oficial para a Liga de ClÃ£s</p>
    </header>



    <section id="ranking" class="ranking-section">

       <div class="podium-container scroll-anim">
    <div class="podium-card silver">
        <div class="podium-rank-badge">2Âº</div>
        <div class="podium-info">
            <h3 id="nomeRank2">--</h3>
            <div class="podium-stats-detail">
                <p id="estrelasRank2">â­ 0.00</p>
                <p id="percRank2">ğŸ¯ 0%</p>
                <p id="guerrasRank2">âš”ï¸ 0 Guerras</p>
            </div>
        </div>
    </div>

    <div class="podium-card gold">
        <div class="podium-rank-badge">1Âº</div>
        <div class="podium-info">
            <h2 id="nomeRank1">--</h2>
            <div class="podium-stats-detail">
                <p id="estrelasRank1" style="font-size: 1.1rem;">â­ 0.00</p>
                <p id="percRank1">ğŸ¯ 0%</p>
                <p id="guerrasRank1">âš”ï¸ 0 Guerras</p>
            </div>
        </div>
    </div>

    <div class="podium-card bronze">
        <div class="podium-rank-badge">3Âº</div>
        <div class="podium-info">
            <h3 id="nomeRank3">--</h3>
            <div class="podium-stats-detail">
                <p id="estrelasRank3">â­ 0.00</p>
                <p id="percRank3">ğŸ¯ 0%</p>
                <p id="guerrasRank3">âš”ï¸ 0 Guerras</p>
            </div>
        </div>
    </div>
</div>

        <div class="controles-container scroll-anim">
            <div class="menu-abas">
                <button class="aba-btn active" onclick="mudarOrdem('qtd')">âš”ï¸ Por Guerras</button>
                <button class="aba-btn" onclick="mudarOrdem('mediaE')">â­ Por Estrelas</button>
                <button class="aba-btn" onclick="mudarOrdem('mediaP')">ğŸ¯ Por %</button>
            </div>

            <div class="filtros-extras">
                <select id="filtroCV" onchange="filtrarTudo()">
                    <option value="todos">Todos os CVs</option>
                    <option value="18">Apenas CV 18</option>
                    <option value="17">Apenas CV 17</option>
                    <option value="16">Apenas CV 16</option>
                </select>
                <input type="text" id="inputBusca" placeholder="ğŸ” Buscar jogador..." onkeyup="filtrarTudo()">
            </div>
        </div>
        <div class="ranking-card scroll-anim">
            <h2 class="title">ğŸ“Š RANKING MENSAL ACUMULADO</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Jogador</th>
                            <th>Guerras</th>
                            <th>MÃ©dia â­</th>
                            <th>MÃ©dia %</th>
                            <th>CV</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="corpoRanking">
                        <tr>
                            <td colspan="7" style="text-align:center;">Carregando dados da FamÃ­lia...</td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <p style="margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center;">
                * Dados atualizados automaticamente via Google Sheets apÃ³s cada guerra.
            </p>
        </div>
        <div class="criterios-container scroll-anim">
            <div class="criterios-titulo">ğŸ“Œ CritÃ©rios de Desempate</div>
            <div class="criterios-lista">
                <div class="criterio-item">
                    <div class="criterio-rank">1Âº</div>
                    <div class="criterio-texto">âš”ï¸ Guerras</div>
                </div>
                <div class="criterio-item">
                    <div class="criterio-rank">2Âº</div>
                    <div class="criterio-texto">â­ Estrelas</div>
                </div>
                <div class="criterio-item">
                    <div class="criterio-rank">3Âº</div>
                    <div class="criterio-texto">ğŸ¯ % DestruiÃ§Ã£o</div>
                </div>
                <div class="criterio-item">
                    <div class="criterio-rank">4Âº</div>
                    <div class="criterio-texto">ğŸ° Centro de Vila</div>
                </div>
            </div>
        </div>
    </section>


    <footer>
        <p>Â© 2026 Clash City BR - Sistema de GestÃ£o de Guerra</p>
    </footer>

    <script>

      // 1. CONFIGURAÃ‡Ã•ES E VARIÃVEIS GERAIS
let dadosGlobais = []; 
let ordemAtual = 'qtd'; 
const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSiUmjut5jrsU0_71z_k-l_enGQ8owypWsyAHd3Xxp8KGkhG9GDI8awbPTvaNY7z6Clz0XpLs5IUGkI/pub?output=csv";

// 2. CARREGAMENTO E PROCESSAMENTO
async function carregarDados() {
    try {
        const resposta = await fetch(urlCSV);
        const csv = await resposta.text();
        const linhas = csv.split(/\r?\n/).slice(1);
        let jogadores = {};

        linhas.forEach(linha => {
            const col = linha.split(',');
            if (col.length < 7) return;

            const nome = col[1].trim();
            const cv = col[2].trim();
            const e1 = parseInt(col[3]) || 0;
            const p1 = parseInt(col[4]) || 0;
            const e2 = parseInt(col[5]) || 0;
            const p2 = parseInt(col[6]) || 0;

            if (!jogadores[nome]) {
                jogadores[nome] = { nome, cv, totalE: 0, totalP: 0, qtd: 0 };
            }
            jogadores[nome].cv = cv;
            jogadores[nome].totalE += (e1 + e2);
            jogadores[nome].totalP += (p1 + p2) / 2;
            jogadores[nome].qtd += 1;
        });

        dadosGlobais = Object.values(jogadores).map(p => ({
            ...p,
            mediaE: p.totalE / p.qtd,
            mediaP: p.totalP / p.qtd
        }));

        atualizarCardsEstatisticas(dadosGlobais);
        filtrarTudo();

    } catch (e) {
        console.error("Erro ao carregar:", e);
        const corpo = document.getElementById('corpoRanking');
        if (corpo) corpo.innerHTML = "<tr><td colspan='7'>Erro ao carregar dados. Verifique a conexÃ£o.</td></tr>";
    }
}

// 3. FILTRAGEM E ORDENAÃ‡ÃƒO
function mudarOrdem(novaOrdem) {
    ordemAtual = novaOrdem;
    document.querySelectorAll('.aba-btn').forEach(btn => {
        btn.classList.remove('active');
        // Verifica se o texto do botÃ£o ou o atributo bate com a ordem
        if (btn.innerText.toLowerCase().includes(novaOrdem.toLowerCase()) || 
            btn.getAttribute('onclick')?.includes(novaOrdem)) {
            btn.classList.add('active');
        }
    });
    filtrarTudo();
}

function filtrarTudo() {
    const busca = document.getElementById('inputBusca')?.value.toUpperCase() || "";
    const cvSelecionado = document.getElementById('filtroCV')?.value || "todos";

    let listaFiltrada = dadosGlobais.filter(p => {
        const matchesBusca = p.nome.toUpperCase().includes(busca);
        const matchesCV = cvSelecionado === "todos" || p.cv === cvSelecionado;
        return matchesBusca && matchesCV;
    });

    listaFiltrada.sort((a, b) => {
        if (ordemAtual === 'qtd') {
            if (b.qtd !== a.qtd) return b.qtd - a.qtd;
            if (b.mediaE !== a.mediaE) return b.mediaE - a.mediaE;
            return b.mediaP - a.mediaP;
        }
        if (ordemAtual === 'mediaE') {
            if (b.mediaE !== a.mediaE) return b.mediaE - a.mediaE;
            if (b.mediaP !== a.mediaP) return b.mediaP - a.mediaP;
            return b.qtd - a.qtd;
        }
        return b.mediaP - a.mediaP;
    });

    renderizar(listaFiltrada);
}

// 4. RENDERIZAÃ‡ÃƒO (PÃ“DIO E TABELA)
function renderizar(dados) {
    const corpo = document.getElementById('corpoRanking');
    if (!corpo) return;

    // AtualizaÃ§Ã£o do PÃ³dio
    for (let i = 1; i <= 3; i++) {
        const player = dados[i - 1];
        const nomeEl = document.getElementById(`nomeRank${i}`);
        const estEl = document.getElementById(`estrelasRank${i}`);
        const perEl = document.getElementById(`percRank${i}`);
        const gueEl = document.getElementById(`guerrasRank${i}`);

        if (player) {
            if (nomeEl) nomeEl.innerText = player.nome;
            if (estEl) estEl.innerText = `â­ ${player.mediaE.toFixed(2)}`;
            if (perEl) perEl.innerText = `ğŸ¯ ${player.mediaP.toFixed(1)}%`;
            if (gueEl) gueEl.innerText = `âš”ï¸ ${player.qtd} Guerras`;
        } else {
            if (nomeEl) nomeEl.innerText = "--";
            if (estEl) estEl.innerText = "â­ 0.00";
            if (perEl) perEl.innerText = "ğŸ¯ 0%";
            if (gueEl) gueEl.innerText = "âš”ï¸ 0";
        }
    }

    // AtualizaÃ§Ã£o do MVP (Sempre o 1Âº da lista filtrada)
    const mvpNome = document.getElementById('mvpNome');
    if (mvpNome) mvpNome.innerText = dados[0] ? dados[0].nome : "---";

    // ConstruÃ§Ã£o da Tabela
    let htmlFinal = "";
    dados.forEach((p, i) => {
        const corBarra = p.mediaE >= 5.5 ? '#22c55e' : (p.mediaE >= 4.5 ? '#f9d246' : '#eb5c09');
        const statusClass = p.mediaE >= 5.5 ? 'titular-badge' : (p.mediaE >= 4.5 ? 'reserva-badge' : 'bagre-badge');
        const statusTxt = p.mediaE >= 5.5 ? 'ELITE' : (p.mediaE >= 4.5 ? 'NA MÃ‰DIA' : 'BAGRE');
        
        const medalhas = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];
        const rankLabel = i < 3 ? medalhas[i] : (i + 1) + "Âº";

        htmlFinal += `
            <tr>
                <td class="${i < 3 ? 'top-3' : 'rank-number'}">${rankLabel}</td>
                <td><strong>${p.nome}</strong></td>
                <td>
                    <div style="font-weight: bold; margin-bottom: 2px;">â­ ${p.mediaE.toFixed(2)}</div>
                    <div class="progresso-container">
                        <div class="progresso-barra" style="width: ${(p.mediaE / 6) * 100}%; background: ${corBarra};"></div>
                    </div>
                </td>
                <td>${p.mediaP.toFixed(1)}%</td>
                <td><span class="cv-tag">CV ${p.cv}</span></td>
                <td>${p.qtd}</td>
                <td><span class="${statusClass}">${statusTxt}</span></td>
            </tr>`;
    });

    corpo.innerHTML = htmlFinal;
}

// 5. FUNÃ‡Ã•ES AUXILIARES E INICIALIZAÃ‡ÃƒO
function atualizarCardsEstatisticas(dados) {
    const totalMembros = document.getElementById('totalMembros');
    const melhorPlayer = document.getElementById('melhorPlayer');
    
    if (totalMembros) totalMembros.innerText = dados.length;
    if (melhorPlayer) {
        const top = [...dados].sort((a,b) => b.mediaE - a.mediaE)[0];
        melhorPlayer.innerText = top ? top.nome : "--";
    }
}

document.addEventListener('DOMContentLoaded', () => {
    carregarDados();
    
    // Observer para animaÃ§Ãµes de scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('show');
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.scroll-anim').forEach(el => observer.observe(el));
});
    </script>
</body>
</html>
