<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/Perfil_COC-removebg-preview.png" type="image/x-icon">
    <title>Clash City BR - Desempenho de Guerra</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <nav>
        <a href="https://clashcitybr.github.io">Home</a>
    </nav>

    <header>
        <h1 class="scroll-anim">Desempenho de Guerra</h1>
        <p class="scroll-anim" style="color: var(--primary); font-weight: 600;">SeleÃ§Ã£o Oficial para a Liga de ClÃ£s</p>
    </header>

    <section id="ranking" class="ranking-section">
      
  
        <div class="ranking-card scroll-anim">
            <h2 class="title">ğŸ“Š RANKING MENSAL ACUMULADO</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Jogador</th>
                            <th>Guerras</th>
                            <th>MÃ©dia â­</th>
                            <th>MÃ©dia %</th>
                            <th>CV</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="corpoRanking">
                        <tr>
                            <td colspan="7" style="text-align:center;">Carregando dados da FamÃ­lia...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
 

            <p style="margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center;">
                * Dados atualizados automaticamente via Google Sheets apÃ³s cada guerra.
            </p>
        </div>
     <div class="legenda-container scroll-anim">
    <div class="legenda-titulo">ğŸ“Œ CRITÃ‰RIOS DE DESEMPATE</div>
    <div class="legenda-grid">
        <div class="legenda-item">
            <span class="legenda-rank">1Âº</span>
            <span class="legenda-texto">âš”ï¸ <strong>Guerras</strong></span>
        </div>
        <div class="legenda-item">
            <span class="legenda-rank">2Âº</span>
            <span class="legenda-texto">â­ <strong>Estrelas</strong></span>
        </div>
        <div class="legenda-item">
            <span class="legenda-rank">3Âº</span>
            <span class="legenda-texto">ğŸ¯ <strong>% DestruiÃ§Ã£o</strong></span>
        </div>
        <div class="legenda-item">
            <span class="legenda-rank">4Âº</span>
            <span class="legenda-texto">ğŸ° <strong>Centro de Vila</strong></span>
        </div>
    </div>
</div>
    </section>


    <footer>
        <p>Â© 2026 Clash City BR - Sistema de GestÃ£o de Guerra</p>
    </footer>

    <script>
        // 1. LINK DA PLANILHA (CSV PUBLICADO)
        const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSiUmjut5jrsU0_71z_k-l_enGQ8owypWsyAHd3Xxp8KGkhG9GDI8awbPTvaNY7z6Clz0XpLs5IUGkI/pub?output=csv";

        async function carregarDados() {
            try {
                const resposta = await fetch(urlCSV);
                const csv = await resposta.text();
                const linhas = csv.split(/\r?\n/).slice(1);

                let jogadores = {};

                linhas.forEach(linha => {
                    const col = linha.split(',');
                    if (col.length < 7) return;

                    const nome = col[1].trim();
                    const cv = col[2].trim();
                    const e1 = parseInt(col[3]) || 0;
                    const p1 = parseInt(col[4]) || 0;
                    const e2 = parseInt(col[5]) || 0;
                    const p2 = parseInt(col[6]) || 0;

                    if (!jogadores[nome]) {
                        jogadores[nome] = { nome, cv, totalE: 0, totalP: 0, qtd: 0 };
                    }
                    jogadores[nome].cv = cv;
                    jogadores[nome].totalE += (e1 + e2);
                    jogadores[nome].totalP += (p1 + p2) / 2;
                    jogadores[nome].qtd += 1;
                });

                const ranking = Object.values(jogadores).map(p => ({
                    ...p,
                    mediaE: p.totalE / p.qtd,
                    mediaP: p.totalP / p.qtd
                })).sort((a, b) => {
                    // 1Âº CritÃ©rio: Quantidade de Guerras (Prioridade MÃ¡xima)
                    if (b.qtd !== a.qtd) return b.qtd - a.qtd;

                    // 2Âº CritÃ©rio: MÃ©dia de Estrelas
                    if (b.mediaE !== a.mediaE) return b.mediaE - a.mediaE;

                    // 3Âº CritÃ©rio: MÃ©dia de Porcentagem
                    if (b.mediaP !== a.mediaP) return b.mediaP - a.mediaP;

                    // 4Âº CritÃ©rio: NÃ­vel do CV
                    return parseInt(b.cv) - parseInt(a.cv);
                });

                renderizar(ranking);
            } catch (e) {
                console.error("Erro ao processar dados:", e);
                document.getElementById('corpoRanking').innerHTML = "<tr><td colspan='7'>Erro ao carregar dados.</td></tr>";
            }
        }

        function renderizar(dados) {
            const corpo = document.getElementById('corpoRanking');
            if (!corpo) return;

            let htmlFinal = "";
            let rankReal = 1;

            dados.forEach((p, i) => {
                // LÃ³gica de Empate: verifica se o atual Ã© idÃªntico ao anterior em todos os critÃ©rios
                if (i > 0) {
                    const anterior = dados[i - 1];
                    const empatou = p.qtd === anterior.qtd &&
                        p.mediaE === anterior.mediaE &&
                        p.mediaP === anterior.mediaP &&
                        p.cv === anterior.cv;

                    if (!empatou) {
                        rankReal = i + 1;
                    }
                }

                // DefiniÃ§Ã£o do Status baseado na posiÃ§Ã£o
                const status = rankReal <= 10
                    ? '<span class="titular-badge">ELITE</span>'
                    : rankReal <= 21
                        ? '<span class="reserva-badge">Na MÃ©dia</span>'
                        : '<span class="bagre-badge">BAGRE</span>';

                // Ãcones de medalha para o Top 3
                const medalhas = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];
                const rankLabel = rankReal <= 3 ? medalhas[rankReal - 1] : rankReal + "Âº";
                const rankClass = rankReal <= 3 ? 'top-3' : 'rank-number';

                htmlFinal += `
            <tr>
                <td class="${rankClass}">${rankLabel}</td>
                <td><strong>${p.nome}</strong></td>
                <td style="color: #c08d00; font-weight: bold;">â­ ${p.mediaE.toFixed(2)}</td>
                <td>${p.mediaP.toFixed(1)}%</td>
                <td><span class="cv-tag">CV ${p.cv}</span></td>
                <td>${p.qtd}</td>
                <td>${status}</td>
            </tr>`;
            });

            corpo.innerHTML = htmlFinal;
        }

        // ConfiguraÃ§Ã£o da AnimaÃ§Ã£o de Scroll e InicializaÃ§Ã£o
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('show');
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.scroll-anim').forEach((el) => observer.observe(el));

        // Chama a funÃ§Ã£o principal para carregar os dados da planilha
        carregarDados();
    </script>
</body>
</html>